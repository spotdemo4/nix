bots:
  # Default bot configuration
  - import: (data)/meta/default-config.yaml

dnsbl: false

# https://anubis.techaro.lol/docs/admin/configuration/open-graph/
openGraph:
  enabled: true
  considerHost: true
  ttl: 24h

# Deny so traefik clients are redirected
# https://anubis.techaro.lol/docs/admin/configuration/custom-status-codes
status_codes:
  CHALLENGE: 403
  DENY: 403

# https://anubis.techaro.lol/docs/admin/policies#storage-backends
store:
  backend: valkey
  parameters:
    url: "redis://@valkey@:6379/0"

# Default thresholds
# https://anubis.techaro.lol/docs/admin/configuration/thresholds
thresholds:
  - name: minimal-suspicion
    expression: weight <= 0
    action: ALLOW

  - name: mild-suspicion
    expression:
      all:
        - weight > 0
        - weight < 10
    action: CHALLENGE
    challenge:
      # https://anubis.techaro.lol/docs/admin/configuration/challenges/metarefresh
      algorithm: metarefresh
      difficulty: 1
      report_as: 1

  - name: moderate-suspicion
    expression:
      all:
        - weight >= 10
        - weight < 20
    action: CHALLENGE
    challenge:
      # https://anubis.techaro.lol/docs/admin/configuration/challenges/proof-of-work
      algorithm: fast
      difficulty: 2
      report_as: 2

  - name: mild-proof-of-work
    expression:
      all:
        - weight >= 20
        - weight < 30
    action: CHALLENGE
    challenge:
      algorithm: fast
      difficulty: 4
      report_as: 4

  - name: extreme-suspicion
    expression: weight >= 30
    action: CHALLENGE
    challenge:
      algorithm: fast
      difficulty: 6
      report_as: 6
