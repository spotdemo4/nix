# yaml-language-server: $schema=https://json.schemastore.org/traefik-v3-file-provider.json

http:
  middlewares:
    cors:
      headers:
        customResponseHeaders:
          Access-Control-Allow-Origin: "*"
          Access-Control-Allow-Methods: "*"
          Access-Control-Allow-Headers: "*"

    security-headers:
      headers:
        frameDeny: true
        browserXssFilter: true

    rate-limit:
      rateLimit:
        average: 100
        period: 1s
        burst: 200

    crowdsec:
      plugin:
        bouncer:
          enabled: true
          defaultDecisionSeconds: 60
          crowdsecMode: live
          crowdsecLapiKey: { { env "CROWDSEC" } }
          crowdsecLapiHost: 10.10.10.109:6061
          crowdsecLapiScheme: http
          crowdsecLapiTLSInsecureVerify: false
          forwardedHeadersTrustedIPs:
            # private class ranges
            - 10.0.0.0/8
            - 172.16.0.0/12
            - 192.168.0.0/16
          clientTrustedIPs:
            # private class ranges
            - 10.0.0.0/8
            - 172.16.0.0/12
            - 192.168.0.0/16

    auth-trev:
      basicAuth:
        removeHeader: true
        usersFile: "@user-trev@"

    auth-admin:
      basicAuth:
        removeHeader: true
        usersFile: "@user-admin@"

    secure:
      chain:
        middlewares:
          - security-headers
          - rate-limit
          - crowdsec

    secure-trev:
      chain:
        middlewares:
          - secure
          - auth-trev

    secure-admin:
      chain:
        middlewares:
          - secure
          - auth-admin
